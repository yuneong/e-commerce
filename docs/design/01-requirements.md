# 유저 시나리오 기반 기능 정의, 요구사항 명세

## 1. 유저 (Users) <-> 브랜드 & 상품 (Brands & Products)

### 1-1. 👤 시나리오 (사용자 관점)
```
사용자는 브랜드 및 상품 정보를 확인할 수 있다.
```

### 1-2. ⚙️ 기능 명세 (시스템 관점)
```
- 목적 : 사용자는 브랜드 정보를 확인하고, 브랜드별 상품을 다양한 기준으로 정렬하여 조회할 수 있어야 한다. 또한 상품 상세 정보를 조회할 수 있어야 한다.
- 주체 : 로그인한 사용자 (또는 비로그인 사용자)
- 주요 시나리오 :
    1. 사용자가 브랜드 목록 또는 브랜드 상세 정보를 조회한다.
    2. 사용자가 특정 브랜드의 상품 목록을 조회한다.
    3. 사용자가 정렬 기준(latest, price_asc, likes_desc)을 선택하여 상품 목록을 정렬하여 조회한다.
    4. 사용자가 상품을 클릭하여 상세 정보를 확인한다.
- 시스템 동작 (낙관적) :
    1. 브랜드/상품 ID 유효성 확인
    2. 상품 목록 요청 시, brandId, 정렬 기준(sort), 페이지(page), 사이즈(size) 파라미터 검증
    3. 상품 데이터 필터링 및 정렬 후 조회 (좋아요 수 포함)
    4. 상품 상세 정보 요청 시, 상품 ID로 정보 조회
    5. 상품 상세 정보 반환 (좋아요 수 포함)
    6. 사용자가 로그인 한 경우, 유저의 해당 상품의 좋아요 여부를 포함하여 반환
- 예외 처리 (비관적) :
    1. 존재하지 않는 브랜드/상품 ID 요청 시 -> 404
    2. 잘못된 형식의 브랜드/상품 ID -> 400
    3. 잘못된 정렬 조건 -> 400 또는 default 정렬
- 체크리스트 :
    1. 응답이 정해진 스펙대로 내려가는지?
    2. 정렬 기준에 따라 응답 순서가 올바르게 정렬되는지?
    3. 좋아요 수가 상품 목록/상세에 포함되어 있는지?
    4. 로그인 상태일 경우, 좋아요 여부도 함께 내려가는지?
    5. 페이징 정보가 정확히 적용되는지?
```

---

## 2. 유저 (Users) <-> 좋아요 (Likes)
### 2-1. 👤 시나리오 (사용자 관점)
```
사용자는 상품에 좋아요를 누를 수 있다.
```

### 2-2. ⚙️ 기능 명세 (시스템 관점)
```
- 목적 : 사용자는 상품에 좋아요를 등록하거나 취소할 수 있어야 하며, 내가 좋아요한 상품 목록을 조회할 수 있어야 한다.
- 주체 : 로그인한 사용자
- 주요 시나리오 :
  1. 사용자가 특정 상품에 좋아요 요청을 보낸다.
  2. 시스템은 해당 상품에 좋아요가 이미 존재하는지 확인한다.
    2-1. 이미 좋아요가 되어 있다면 -> 좋아요 삭제
    2-2. 좋아요가 되어 있지 않다면 -> 좋아요 등록
  3. 시스템은 해당 상품의 좋아요 수를 업데이트한다.
- 시스템 동작 (낙관적) :
    1. 로그인 사용자 ID 인증
    2. 요청한 상품의 ID 유효성 확인
    3. 요청 상품에 대한 좋아요 존재 여부를 확인
    4. 좋아요 등록/삭제
    5. 요청 상품의 좋아요 수를 업데이트
    6. 내가 좋아요 한 상품 목록을 조회할 때, 각 상품의 좋아요 여부를 포함하여 반환한다.
- 예외 처리 (비관적) :
    1. 로그인하지 않은 사용자 -> 401
    2. 존재하지 않는 상품 ID 요청 시 -> 404
    3. 잘못된 형식의 상품 ID -> 400
- 체크리스트 :
    1. 동일 사용자가 여러 번 요청해도 중복 등록되지 않는지?
    2. 요청마다 좋아요 수가 정확히 반영되는지?
    3. 비로그인 시도는 차단되는지?
    4. 내 좋아요 목록 조회 시 실제 좋아요 여부가 포함되는지?
```

---

## 3. 유저 (Users) <-> 주문 / 결제 (Orders)

### 3-1. 👤 시나리오 (사용자 관점)
```
사용자는 브랜드 상품 목록이나 여러 상품을 조회하여 원하는 상품을 선택한다.
선택한 여러 상품과 수량을 한 번에 주문하고, 포인트로 결제한다.
주문이 완료되면 주문 내역을 조회하고, 상세 정보를 확인할 수 있다.
```

### 3-2. ⚙️ 기능 명세 (시스템 관점)
```
- 목적 : 사용자는 여러 상품을 한 번에 주문하고 포인트로 결제할 수 있어야 하고, 주문 후 본인의 주문 내역과 상세 정보를 확인할 수 있어야 한다.
- 주체 : 로그인한 사용자
- 주요 시나리오 :
    1. 사용자가 여러 상품을 선택한 후, 주문 정보(상품 ID, 개수 등)를 담아 주문 요청을 보낸다.
    2. 시스템은 각 상품의 재고를 확인하고 차감 가능 여부를 판단한다.
    3. 사용자의 보유 포인트를 확인하고, 주문 금액만큼 차감 가능 여부를 판단한다.
    4. 상품의 재고를 차감하고, 사용자의 포인트를 차감한다.
    5. 주문 정보를 생성하고, 주문 ID를 반환한다.
    6. 주문 정보는 외부 시스템(Mock)으로 전송된다.
    7. 사용자는 주문 목록과 각 주문의 상세 내역을 조회할 수 있다.
- 시스템 동작 (낙관적) :
    1. 로그인 사용자 ID 인증
    2. 요청 파라미터 검증 (상품 ID, 개수 등)
    3. 상품 재고 확인 및 차감
    4. 사용자 포인트 확인 및 차감
    5. 주문 정보 생성 및 저장
    6. 주문 정보를 외부 시스템으로 전송 (Mock)
    7. 주문 목록 조회 시 주문 ID와 총 결제 금액, 잔여 포인트 등을 포함하여 반환
- 예외 처리 (비관적) :
    1. 로그인 하지 않은 사용자 -> 401
    2. 존재하지 않는 상품 ID 요청 시 -> 404
    3. 잘못된 형식의 상품 ID -> 400
    4. 상품 재고 부족 -> 400 또는 409
    5. 포인트 부족 -> 400 또는 409
- 체크리스트 :
    1. 여러 상품을 한 번에 주문할 때, 재고/포인트 차감이 모두 트랜잭션 내에서 처리 되는지?
    2. 주문 실패 시, 모든 재고와 포인트는 롤백되는지?
    3. 동일한 요청을 여러 번 보내도 중복 주문이 되지 않는지?
    4. 응답에는 주문 ID와 총 결제 금액, 잔여 포인트 등이 포함되어 있는지?
```


