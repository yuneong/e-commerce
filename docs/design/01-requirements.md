# [유저 시나리오 기반 기능 정의, 요구사항 명세]

## 1. 유저 (Users) <-> 브랜드 & 상품 (Brands & Products)

### 1-1. 👤 시나리오 (사용자 관점)
```
사용자는 브랜드 및 상품 정보를 확인할 수 있다.
```

### 1-2. ⚙️ 기능 명세 (시스템 관점)
```
- 목적 : 사용자는 브랜드 정보를 확인하고, 브랜드별 상품을 다양한 기준으로 정렬하여 조회할 수 있어야 한다. 또한 상품 상세 정보를 조회할 수 있어야 한다.
- 주체 : 로그인한 사용자 (또는 비로그인 사용자)
- 주요 시나리오 :
    1. 사용자가 브랜드 목록 또는 브랜드 상세 정보를 조회한다.
    2. 사용자가 특정 브랜드의 상품 목록을 조회한다.
    3. 사용자가 정렬 기준(latest, price_asc, likes_desc)을 선택하여 상품 목록을 정렬하여 조회한다.
    4. 사용자가 상품을 클릭하여 상세 정보를 확인한다.
- 시스템 동작 (낙관적) :
    1. 브랜드/상품 ID 유효성 확인
    2. 상품 목록 요청 시, brandId, 정렬 기준(sort), 페이지(page), 사이즈(size) 파라미터 검증
    3. 상품 데이터 필터링 및 정렬 후 조회 (좋아요 수 포함)
    4. 상품 상세 정보 요청 시, 상품 ID로 정보 조회
    5. 상품 상세 정보 반환 (좋아요 수 포함)
    6. 사용자가 로그인 한 경우, 유저의 해당 상품의 좋아요 여부를 포함하여 반환
- 예외 처리 (비관적) :
    1. 존재하지 않는 브랜드/상품 ID 요청 시 -> 404
    2. 잘못된 형식의 브랜드/상품 ID -> 400
    3. 잘못된 정렬 조건 -> 400 또는 default 정렬
- 체크리스트 :
    1. 응답이 정해진 스펙대로 내려가는지?
    2. 정렬 기준에 따라 응답 순서가 올바르게 정렬되는지?
    3. 좋아요 수가 상품 목록/상세에 포함되어 있는지?
    4. 로그인 상태일 경우, 좋아요 여부도 함께 내려가는지?
    5. 페이징 정보가 정확히 적용되는지?
```

---

## 2. 유저 (Users) <-> 좋아요 (Likes)
### 2-1. 👤 시나리오 (사용자 관점)
```
사용자는 상품에 좋아요를 등록하거나, 이미 등록된 좋아요를 취소할 수 있다.
또한, 자신이 좋아요를 누른 상품 목록을 확인할 수 있다.
```

### 2-2. ⚙️ 기능 명세 (시스템 관점)

#### 🔺 목적 : 사용자는 상품에 좋아요를 등록하거나 취소할 수 있어야 하며, 내가 좋아요한 상품 목록을 조회할 수 있어야 한다.
#### 🔺 주체 : 로그인한 사용자
#### 🔺 주요 시나리오 :
    1. 사용자는 상품에 좋아요를 등록하거나 취소할 수 있다.
    2. 시스템은 요청에 따라 좋아요 상태를 변경하고, 상품의 좋아요 수를 반영한다.
    3. 사용자는 본인이 좋아요한 상품 목록을 조회할 수 있다.
#### 🔺 시스템 동작 (낙관적) :
    1. 로그인 사용자 ID 인증
    2. 요청한 상품 ID의 유효성 검증
    3. 좋아요 등록 시:
        3-1. likedYn = 'Y'로 업데이트 시도
        3-2. 업데이트된 행이 없으면 새로 삽입
    4. 좋아요 취소 시:
        4-1. likedYn = 'N'으로 업데이트 시도
        4-2. 업데이트된 행이 없어도 성공 응답 반환
    5. 상품의 좋아요 수 증감 처리
    6. 좋아요 목록 조회 시 likedYn = 'Y'인 항목만 조회
#### 🔺 예외 처리 (비관적) :
    1. 로그인하지 않은 사용자 -> 401
    2. 존재하지 않는 상품 ID 요청 시 -> 404
    3. 잘못된 형식의 상품 ID -> 400
#### 🔺 체크리스트 :
    1. 동일 사용자가 여러 번 등록/삭제 요청을 보내도 상태가 일관되게 유지되는가?
    2. 좋아요 수가 정확히 반영되는지?
    3. 비로그인 시도는 차단되는지?
    4. 좋아요 목록 조회 시 실제 사용자가 눌렀던 상품만 반환되는지?

---

## 3. 유저 (Users) <-> 주문 / 결제 (Orders)

### 3-1. 👤 시나리오 (사용자 관점)
```
장바구니에 담긴 상품 중 일부 또는 전체를 선택하여 주문 결제를 진행할 수 있다.
주문 시 포인트로 결제하며, 주문이 완료되면 주문 내역과 상세 정보를 확인할 수 있다.
```

### 3-2. ⚙️ 기능 명세 (시스템 관점)

#### 🔺 목적 : 사용자는 여러 상품 또는 단일 상품을 한 번에 주문하고 포인트로 결제할 수 있어야 하고, 주문 후 본인의 주문 내역과 상세 정보를 확인할 수 있어야 한다.
#### 🔺 주체 : 로그인한 사용자
#### 🔺 주요 시나리오 :
    1. 사용자가 장바구니에 담은 상품을 선택하고 주문을 요청한다.
    2. 시스템은 상품 재고 및 사용자 포인트를 확인하고 주문 가능 여부를 판단한다.
    3. 주문 정보와 결제를 처리하고 장바구니를 정리한 뒤 응답을 반환한다.
#### 🔺 시스템 동작 (낙관적) :
    1. 로그인 사용자 ID 인증
    2. 상품 재고, 사용자 포인트 확인
    3. 상품 재고, 사용자 포인트 차감
    4. 주문 정보 생성
    5. 주문 정보를 외부 시스템으로 전송 (PG라고 가정)
    6. 장바구니에 들어있던 상품 항목 제거
    7. 주문, 결제 ID와 구매 상품 내역, 총 결제 금액 등을 포함하여 반환
#### 🔺 예외 처리 (비관적) :
    1. 로그인 하지 않은 사용자 -> 401
    2. 존재하지 않는 상품 ID 요청 시 -> 404
    3. 잘못된 형식의 장바구니 항목 -> 400
    4. 상품 재고 부족 -> 409
    5. 포인트 부족 -> 409
#### 🔺 체크리스트 :
    1. 여러 상품을 한 번에 주문할 때, 재고/포인트 차감이 모두 트랜잭션 내에서 처리 되는지?
    2. 주문 실패 시, 모든 재고와 포인트는 롤백되는지?
    3. 동일한 요청을 여러 번 보내도 중복 주문이 되지 않는지?
    4. 응답에는 주문, 결제 ID와 구매 상품 내역, 총 결제 금액 등이 포함되어 있는지?
    5. 결제 완료 후 장바구니 항목이 정확히 제거되는지?

---
